{% extends 'layout.html' %}
{% load static %}

{% block title %}
  Chirpy
{% endblock %}

{% block content %}
  <div class="container mt-4 mb-4">
    <div class="mb-4">
      <a href="{% url 'create_tweet' %}" class="btn btn-primary">Create Tweet</a>
    </div>
    {% if tweets %}
      <div class="row g-4">
        {% for tweet in tweets %}
          <div class="col-md-4 col-sm-4">
            <div class="card h-100 bg-dark text-light border-secondary">
              <div class="position-relative">
                {% if tweet.photo %}
                  <div class="ratio ratio-1x1">
                    <img src="{{ tweet.photo.url }}" class="w-100 h-100 object-fit-cover" alt="Tweet image" />
                  </div>
                {% endif %}

                {% if tweet.user == request.user %}
                  <div class="position-absolute top-0 end-0 m-2 dropdown">
                    <button class="btn btn-sm btn-outline-light rounded-circle" data-bs-toggle="dropdown"><i class="bi bi-three-dots-vertical"></i></button>

                    <ul class="dropdown-menu dropdown-menu-end">
                      <li>
                        <a class="dropdown-item" href="{% url 'tweet_edit' tweet.id %}"><i class="bi bi-pencil me-2"></i> Edit</a>
                      </li>
                      <li>
                        <button class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#deleteTweetModal{{ tweet.id }}"><i class="bi bi-trash me-2"></i> Delete</button>
                      </li>
                    </ul>
                  </div>
                {% endif %}
              </div>

              <div class="card-body">
                <h5 class="card-title">{{ tweet.user.username }}</h5>
                <p class="card-text">{{ tweet.text }}</p>
              </div>

              <div class="card-footer text-muted small border-secondary">Last updated: {{ tweet.updated_at|date:'M d, Y Â· H:i' }}</div>
            </div>
          </div>

          <div class="modal fade" id="deleteTweetModal{{ tweet.id }}" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content bg-dark text-light border-secondary">
                <div class="modal-header border-secondary">
                  <h5 class="modal-title">Delete Tweet</h5>
                  <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                  <p>Are you sure you want to delete this tweet?</p>
                  <p class="small text-muted">{{ tweet.text }}</p>
                </div>

                <div class="modal-footer border-secondary">
                  <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>

                  <form method="post" action="{% url 'tweet_delete' tweet.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Delete</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="d-flex flex-column justify-content-center align-items-center text-center py-5">
        <lottie-player src="{% static 'lottie/newBird.json' %}" background="transparent" speed="1" style="width: 250px; height: 250px;" loop autoplay></lottie-player>

        <h4 class="text-secondary mt-3">No tweets found</h4>
      </div>
    {% endif %}
  </div>
{% endblock %}
